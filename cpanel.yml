deploy:
  tasks:
    - run: echo "Starting Flask deploy (cPanel) ..."
    - run: python3 -V || true
    - run: python3 -m venv /home/iqfrizqe/venv_dl_farm || true
    - run: /home/iqfrizqe/venv_dl_farm/bin/pip install --upgrade pip || true
    - run: /home/iqfrizqe/venv_dl_farm/bin/pip install -r requirements.txt || true
    - run: echo "Copying repo to public_html/dl-farm..."
    - run: rm -rf /home/iqfrizqe/public_html/dl-farm || true
    - run: mkdir -p /home/iqfrizqe/public_html/dl-farm
    - run: cp -R . /home/iqfrizqe/public_html/dl-farm/
    - run: echo "Ensuring a passenger_wsgi.py is in place..."
    - run: cat > /home/iqfrizqe/public_html/dl-farm/passenger_wsgi.py <<'PY'
from app import app
application = app
PY
    - run: mkdir -p /home/iqfrizqe/public_html/dl-farm/tmp || true
    - run: touch /home/iqfrizqe/public_html/dl-farm/tmp/restart.txt || true
    - run: echo "Deploy finished."
